<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERA-X Constructs</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <a class="skip-link" href="#main">Skip to main content</a>
    <header>
        <h1><a class="logo" href="#" id="logo-link">SERA-X</a></h1>
        <div id="logo-menu" class="logo-menu">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="research.html">Methodologies</a></li>
                <li><a href="constructs.html">Current Project Status</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </div>
        <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
        <nav class="site-nav" aria-label="Primary">
            <ul>
                <li><a href="sense.html">Sense</a></li>
                <li><a href="explain.html">Explain</a></li>
                <li><a href="respond.html">Respond</a></li>
                <li><a href="adapt.html">Adapt</a></li>
                <li><a href="extended.html">Extended</a></li>
            </ul>
        </nav>
    </header>
    <main id="main">

        <section id="contribute">
            <h2>Contribute a Construct</h2>
            <p>Have an insight from psychology, neuroscience, or other fields? Help expand our benchmark by submitting a construct.</p>
            <p><a class="button" href="https://github.com/maxaeon/SERA-x/issues/new?template=construct.yml">Submit Construct</a></p>
        </section>
        
        <section id="constructs">
            <h2>Tentative Constructs</h2>
            <p>Undergoing development by an interdisciplinary team of experts in psychology, computer science, philosophy, and more.</p>
            <div class="search-controls">
                <label for="construct-search">Search:</label>
                <input type="search" id="construct-search" placeholder="Search constructs">
            </div>
            <div class="sort-controls">
                <label for="sort-select">Sort by:</label>
                <select id="sort-select">
                    <option value="title">Alphabetical</option>
                    <option value="field">Field/Topic</option>
                    <option value="axis">SERA-X Axis</option>
                </select>
            </div>
            <table id="construct-table">
                <thead>
                    <tr>
                        <th>Construct</th>
                        <th>Definition</th>
                        <th>Authors &amp; Sources</th>
                        <th>Axis</th>
                        <th>How to Evaluate</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <section id="literature">
            <h2>Relevant Literature</h2>
            <p>Peerâ€‘reviewed sources linked to our constructs.</p>
            <div class="sort-controls">
                <label for="lit-sort">Sort by:</label>
                <select id="lit-sort">
                    <option value="year">Year</option>
                    <option value="author">Author</option>
                    <option value="title">Title</option>
                    <option value="construct">Construct</option>
                    <option value="axis">SERA-X Axis</option>
                </select>
            </div>
            <table id="lit-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Author(s)</th>
                        <th>Year</th>
                        <th>Relevance</th>
                        <th>Construct</th>
                        <th>Axis</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
    </main>
    <footer>
        <p>&copy; SERA-X contributors</p>
    </footer>
    <script>
    let literature = [];
    let constructs = [];

    function parseMeta(c) {
        const body = (c.body || '').toLowerCase();
        const axes = ['sense','explain','respond','adapt','extended'];
        let foundAxes = [];
        if (c.axes) {
            foundAxes = c.axes.split(',').map(a => a.trim().toLowerCase());
        } else {
            foundAxes = axes.filter(a => body.includes(a));
        }
        c.axis = foundAxes.join(', ');
        const fields = ['psychology','philosophy','neuroscience'];
        const foundFields = fields.filter(f => body.includes(f));
        c.field = foundFields.length ? foundFields.join(', ') : 'other';
        if (c.measurement) {
            c.evaluation = c.measurement;
        } else {
            const evalMatch = (c.body || '').match(/(?:evaluation|ai test task idea)[:\-]?\s*(.*)/i);
            c.evaluation = evalMatch ? evalMatch[1].trim() : '';
        }
    }

    function getSources(c) {
        if (!literature.length) return '';
        const text = ((c.title || '') + ' ' + (c.body || '')).toLowerCase();
        const matches = [];
        literature.forEach(l => {
            const author = (l.authors || '').split(' ')[0];
            if (author && text.includes(author.toLowerCase())) {
                const link = l.url ? `<a href="${l.url}">${l.authors}</a>` : l.authors;
                if (!matches.includes(link)) matches.push(link);
            }
        });
        return matches.join(', ');
    }

    function render(data) {
        const tbody = document.querySelector('#construct-table tbody');
        tbody.innerHTML = '';
        data.forEach(c => {
            const row = document.createElement('tr');
            const sources = getSources(c);
            row.innerHTML = `
                <td><a href="${c.url}">${c.title}</a></td>
                <td>${c.definition || ''}</td>
                <td>${sources}</td>
                <td>${c.axis}</td>
                <td>${c.evaluation || ''}</td>`;
            tbody.appendChild(row);
        });
    }

    fetch('construct_submissions.json')
        .then(r => r.json())
        .then(data => {
            data.forEach(parseMeta);
            constructs = data;
            // Default sort alphabetical
            constructs.sort((a,b)=>a.title.localeCompare(b.title));
            document.getElementById('sort-select').value = 'title';
            render(constructs);
            document.getElementById('sort-select').addEventListener('change', e => {
                const v = e.target.value;
                if (v === 'title') constructs.sort((a,b)=>a.title.localeCompare(b.title));
                else if (v === 'field') constructs.sort((a,b)=>a.field.localeCompare(b.field));
                else if (v === 'axis') constructs.sort((a,b)=>a.axis.localeCompare(b.axis));
                else constructs.sort((a,b)=>new Date(a.created_at)-new Date(b.created_at));
                render(constructs);
            });

            const searchInput = document.getElementById('construct-search');
            searchInput.addEventListener('input', e => {
                const q = e.target.value.trim().toLowerCase();
                const filtered = constructs.filter(c => {
                    const title = (c.title || '').toLowerCase();
                    const def = (c.definition || '').toLowerCase();
                    const syn = Array.isArray(c.synonyms) ? c.synonyms.join(' ').toLowerCase() : (c.synonyms || '').toLowerCase();
                    return !q || title.includes(q) || def.includes(q) || syn.includes(q);
                });
                render(filtered);
            });
        });

    function renderLit(items) {
        const tbody = document.querySelector('#lit-table tbody');
        tbody.innerHTML = '';
        items.forEach(l => {
            const row = document.createElement('tr');
            const titleCell = l.url ? `<a href="${l.url}">${l.title}</a>` : l.title;
            row.innerHTML = `
                <td>${titleCell}</td>
                <td>${l.authors}</td>
                <td>${l.year}</td>
                <td>${l.relevance || ''}</td>
                <td>${(Array.isArray(l.construct) ? l.construct : (l.construct || '').split(/[,;]+/)).map(c => c.trim()).filter(Boolean).join('<br>')}</td>
                <td>${l.axis}</td>`;
            tbody.appendChild(row);
        });
    }

    fetch('literature.json')
        .then(r => r.json())
        .then(lit => {
            literature = lit;
            // Default sort by author
            literature.sort((a,b)=>a.authors.localeCompare(b.authors));
            document.getElementById('lit-sort').value = 'author';
            renderLit(literature);
            render(constructs);
            document.getElementById('lit-sort').addEventListener('change', e => {
                const v = e.target.value;
                if (v === 'title') literature.sort((a,b)=>a.title.localeCompare(b.title));
                else if (v === 'author') literature.sort((a,b)=>a.authors.localeCompare(b.authors));
                else if (v === 'construct') literature.sort((a,b)=>a.construct.localeCompare(b.construct));
                else if (v === 'axis') literature.sort((a,b)=>a.axis.localeCompare(b.axis));
                else literature.sort((a,b)=>(a.year||0)-(b.year||0));
                renderLit(literature);
            });
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
