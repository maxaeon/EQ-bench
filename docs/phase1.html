<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERA-X - Phase 1</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/images/favicon.png">
</head>
<body>
    <a class="skip-link" href="#main">Skip to main content</a>
    <header>
        <h1><a class="logo" href="#" id="logo-link">SERA-X</a></h1>
        <div id="logo-menu" class="logo-menu">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li>
                    <a href="research.html">Project Development</a>
                    <ul>
                        <li><a href="phase1.html">Phase 1</a></li>
                    </ul>
                </li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </div>
        <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
        <nav class="site-nav" aria-label="Primary">
            <ul>
                <li><a href="sense.html">Sense</a></li>
                <li><a href="explain.html">Explain</a></li>
                <li><a href="respond.html">Respond</a></li>
                <li><a href="adapt.html">Adapt</a></li>
                <li><a href="extended.html">Extended</a></li>
            </ul>
        </nav>
    </header>
    <main id="main">
        <section id="contribute">
            <h1>Phase 1: Literature Scan and Axis Feedback</h1>
            <p>We are gathering community input on the proposed SERA-X axes and compiling relevant peerâ€‘reviewed literature.</p>
            <p>Please explore the references below. If you have a new source, use the <em>Add a source</em> button. For broader comments on the SERA-X framework, let us know via our feedback form.</p>
            <p><a class="button" href="https://github.com/maxaeon/SERA-x/issues/new?template=feedback.yml">Share feedback</a></p>
        </section>

        <section id="week0">
            <h2>Week 0 Project: Understanding Benchmark Models</h2>
            <p>As an introductory project, contributors and collaborators are encouraged to familiarize themselves with existing emotional intelligence benchmarking frameworks. Please review our detailed comparison here:</p>
            <p><a href="alternative-models.html"><strong>Comparison of Alternative Emotional Intelligence Models</strong></a></p>
            <p>This background clearly contextualizes why the SERA-X framework was developed and the unique advantages it explicitly offers.</p>
        </section>


        <section id="literature">
            <h2>Relevant Literature</h2>
            <p>Notice something missing? Click the button below to add a source.</p>
            <section><a class="button" href="https://github.com/maxaeon/SERA-x/issues/new?template=reference.yml">Add a source</a></section>
            <p>Submitted issues are automatically exported to the shared JSON databases.<sup><a href="persisting_constructs.md" title="How submissions persist">?</a></sup></p>

            <p><br></p>

            <div class="search-controls">
                <label for="lit-search">Search:</label>
                <input type="search" id="lit-search" placeholder="Search literature">
            </div>
            
            <div class="controls-row">
                <div class="filter-controls">
                    <label for="lit-axis-filter">Axis:</label>
                    <select id="lit-axis-filter" multiple size="1">
                        <option value="">All</option>
                    </select>
                    <label for="lit-construct-filter">Construct:</label>
                    <select id="lit-construct-filter" multiple size="1">
                        <option value="">All</option>
                    </select>
                    <label for="lit-field-filter">Field/Topic:</label>
                    <select id="lit-field-filter" multiple size="1">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="sort-controls">
                    <label for="lit-sort">Sort by:</label>
                    <select id="lit-sort">
                        <option value="year">Year</option>
                        <option value="author">Author</option>
                        <option value="title">Title</option>
                    </select>
                </div>
            </div>
            <table id="lit-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="lit-select-all"></th>
                        <th>Title</th>
                        <th>Author(s)</th>
                        <th>Year</th>
                        <th>Relevance</th>
                        <th>Construct</th>
                        <th>Axis</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
                    <div class="bibtex-controls">
                <a class="button" href="#" id="bibtex-download">Download BibTeX</a>
            </div>
    </main>
    <footer>
        <p>&copy; SERA-X contributors</p>
    </footer>
    <script>

    let literature = [];

    function toTitle(text) {
        return text.replace(/(^|\s)\S/g, t => t.toUpperCase());
    }

    const selectedLit = new Set();

    function toBibtex(item) {
        const keyAuthor = (item.authors || 'ref').split(/[ ,]/)[0].replace(/[^a-zA-Z0-9]/g, '');
        const key = keyAuthor + (item.year || '');
        let entry = `@article{${key},\n  title = {${item.title}}`;
        if (item.authors) entry += `,\n  author = {${item.authors}}`;
        if (item.year) entry += `,\n  year = {${item.year}}`;
        if (item.url) entry += `,\n  url = {${item.url}}`;
        entry += `\n}`;
        return entry;
    }

    function downloadFile(content, filename) {
        const blob = new Blob([content], {type: 'text/x-bibtex'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
    }

    function updateSelectAll() {
        const cbs = document.querySelectorAll('#lit-table tbody .lit-check');
        const allChecked = cbs.length && Array.from(cbs).every(cb => cb.checked);
        document.getElementById('lit-select-all').checked = allChecked;
    }

    function renderLit(items) {
        const tbody = document.querySelector('#lit-table tbody');
        tbody.innerHTML = '';
        items.forEach(l => {
            const checked = selectedLit.has(l.__index) ? 'checked' : '';
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="checkbox" class="lit-check" data-index="${l.__index}" ${checked}></td>
                <td>${l.title}</td>
                <td>${l.authors}</td>
                <td>${l.year}</td>
                <td>${l.relevance || ''}</td>
                <td>${(Array.isArray(l.construct) ? l.construct : (l.construct || '').split(/[,;]+/)).map(c => c.trim()).filter(Boolean).join('<br>')}</td>
                <td>${l.axis}</td>`;
            tbody.appendChild(row);
        });
        tbody.querySelectorAll('.lit-check').forEach(cb => {
            cb.addEventListener('change', () => {
                const idx = parseInt(cb.dataset.index, 10);
                if (cb.checked) selectedLit.add(idx); else selectedLit.delete(idx);
                updateSelectAll();
            });
        });
        updateSelectAll();
    }

    function applyLitFilters() {
        const q = document.getElementById('lit-search').value.trim().toLowerCase();
        const axisVals = Array.from(document.getElementById('lit-axis-filter').selectedOptions).map(o=>o.value).filter(Boolean);
        const constructVals = Array.from(document.getElementById('lit-construct-filter').selectedOptions).map(o=>o.value).filter(Boolean);
        const fieldVals = Array.from(document.getElementById('lit-field-filter').selectedOptions).map(o=>o.value).filter(Boolean);
        let items = literature.filter(l => {
            if (axisVals.length && !axisVals.some(a => (l.axis || '').toLowerCase().includes(a))) return false;
            if (fieldVals.length && !fieldVals.some(f => (l.category || '').toLowerCase().includes(f))) return false;
            if (constructVals.length) {
                const list = Array.isArray(l.construct) ? l.construct : (l.construct || '').split(/[,;]+/);
                if (!constructVals.some(v => list.some(c => c.trim().toLowerCase() === v))) return false;
            }
            if (q) {
                const text = `${l.title || ''} ${l.authors || ''} ${l.relevance || ''}`.toLowerCase();
                if (!text.includes(q)) return false;
            }
            return true;
        });

        const sortVal = document.getElementById('lit-sort').value;
        if (sortVal === 'title') items.sort((a,b)=>a.title.localeCompare(b.title));
        else if (sortVal === 'author') items.sort((a,b)=>a.authors.localeCompare(b.authors));
        else items.sort((a,b)=>(a.year||0)-(b.year||0));
        renderLit(items);
    }

    fetch('literature.json')
        .then(r => r.json())
        .then(lit => {
            literature = lit.map((l, i) => Object.assign({__index: i}, l));

            const axisSet = new Set();
            const fieldSet = new Set();
            const constructSet = new Set();
            literature.forEach(l => {
                if (l.axis) l.axis.split(',').forEach(a => axisSet.add(a.trim()));
                if (l.category) fieldSet.add(l.category.trim().toLowerCase());
                const list = Array.isArray(l.construct) ? l.construct : (l.construct || '').split(/[,;]+/);
                list.forEach(c => constructSet.add(c.trim()));
            });

            const axisF = document.getElementById('lit-axis-filter');
            const axisOrder = ['sense','explain','respond','adapt','extended'];
            axisOrder.forEach(a => { if (axisSet.has(a)) axisF.appendChild(new Option(a.charAt(0).toUpperCase()+a.slice(1), a)); });
            const fieldF = document.getElementById('lit-field-filter');
            const fieldOrder = ['philosophy and ethics','psychology','computer science','neuroscience','other'];
            fieldOrder.forEach(f => { if (fieldSet.has(f)) fieldF.appendChild(new Option(toTitle(f), f)); });
            const constructF = document.getElementById('lit-construct-filter');
            Array.from(constructSet)
                .sort((a,b)=>a.toLowerCase().localeCompare(b.toLowerCase()))
                .forEach(c => { if (c) constructF.appendChild(new Option(c, c.toLowerCase())); });

            enableMultiSelectDropdown(axisF);
            enableMultiSelectDropdown(fieldF);
            enableMultiSelectDropdown(constructF);

            document.getElementById('lit-sort').value = 'author';
            applyLitFilters();

            document.getElementById('lit-sort').addEventListener('change', applyLitFilters);
            axisF.addEventListener('change', applyLitFilters);
            fieldF.addEventListener('change', applyLitFilters);
            constructF.addEventListener('change', applyLitFilters);
            document.getElementById('lit-search').addEventListener('input', applyLitFilters);

            document.getElementById('lit-select-all').addEventListener('change', e => {
                document.querySelectorAll('#lit-table tbody .lit-check').forEach(cb => {
                    cb.checked = e.target.checked;
                    const idx = parseInt(cb.dataset.index, 10);
                    if (e.target.checked) selectedLit.add(idx); else selectedLit.delete(idx);
                });
            });

            document.getElementById('bibtex-download').addEventListener('click', e => {
                e.preventDefault();
                const items = Array.from(selectedLit).map(i => literature.find(l => l.__index === i)).filter(Boolean);
                if (!items.length) return;
                const content = items.map(toBibtex).join('\n\n');
                downloadFile(content, 'references.bib');
            });

        });
    </script>
    <script src="script.js"></script>
</body>
</html>
